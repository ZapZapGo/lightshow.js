/*LightShow v0.7
http://www.github.com/zapzapgo/lightshow.js/
http://raw.github.com/ZapZapGo/lightshow.js/master/license.txt*/var ZapZapGo=window.ZapZapGo||{};ZapZapGo.log=ZapZapGo.log||function(a){};ZapZapGo.LightShow=function(a){this.options=$.extend(true,{},ZapZapGo.LightShow.default_options,a);this.initialize()};ZapZapGo.LightShow.initialize=function(){if(!ZapZapGo.LightShow.is_initialized){ZapZapGo.LightShow.is_initialized=true;ZapZapGo.LightShow.registerKeyCommands()}};ZapZapGo.LightShow.registerKeyCommands=function(){$(document).keydown(function(a){if(a.keyCode==27){var b=0;var c=null;$.each(ZapZapGo.LightShow.instances,function(a,d){if(d.isVisible()&&d.z_index_base>b){b=d.z_index_base;c=d}});if(c&&c.options.hideOnEscape){c.hide()}}})};ZapZapGo.LightShow.instances={};ZapZapGo.LightShow.is_initialized=false;ZapZapGo.LightShow.implicit_id_offset=0;ZapZapGo.LightShow.current_z_index=-1;ZapZapGo.LightShow.default_options={id:"null",overlay:"document",content:null,showOnStartup:false,hideButtonSelector:".hide-button",hideOnEscape:true,style:{opacity:.85,overflow:"hidden",background:null,backgroundColor:"#000"},callback:{initialization:{before:function(){},after:function(){}},show:{before:function(){},after:function(){}},hide:{before:function(){},after:function(){}}},effect:{type:"fade",duration:500,show:null,hide:null}};ZapZapGo.LightShow.getHighestZIndex=function(a){var b=0;$(a).each(function(){var a=ZapZapGo.LightShow.getElementZIndex($(this));if(a>b){b=a}});return b};ZapZapGo.LightShow.getElementZIndex=function(a){return parseInt(a.css("zIndex"),10)};ZapZapGo.LightShow.getInternalId=function(a){return"ls-"+(a==null?"unnamed-"+ ++ZapZapGo.LightShow.implicit_id_offset:a)};ZapZapGo.LightShow.showAll=function(){$.each(ZapZapGo.LightShow.instances,function(a,b){b.show()})};ZapZapGo.LightShow.hideAll=function(){$.each(ZapZapGo.LightShow.instances,function(a,b){b.hide()})};ZapZapGo.LightShow.prototype.is_initialized=false;ZapZapGo.LightShow.prototype.is_visible=false;ZapZapGo.LightShow.prototype.resize_source=null;ZapZapGo.LightShow.prototype.overlay_element=null;ZapZapGo.LightShow.prototype.content_element=null;ZapZapGo.LightShow.prototype.z_index_base=-1;ZapZapGo.LightShow.prototype.effect_wait_for_load=false;ZapZapGo.LightShow.prototype.effect_deferred_callback=null;ZapZapGo.LightShow.prototype.initialize=function(){var a=this;if(!this.options.is_initialized){this.options.is_initialized=true;this.options.callback.initialization.before(this);if(!ZapZapGo.LightShow.is_initialized){ZapZapGo.LightShow.initialize()}if(this.options.overlay){a.effect_wait_for_load=true;a.waitUntilDimensioned($("img, iframe, script",this.options.overlay),function(){a.effect_wait_for_load=false;a.effect_deferred_callback&&a.effect_deferred_callback();a.effect_deferred_callback=null},50,true)}this.setContent(this.options.content);this.initializeOverlay();this.setEffect(this.options.effect.type,this.options.effect.duration);this.readapt(true);if(this.options.showOnStartup){this.show()}this.options.callback.initialization.after(this)}};ZapZapGo.LightShow.prototype.initializeOverlay=function(){var a=this;if(!this.overlay_element){var b=this.createContainer();this.resize_source=a.isDocumentOverlay()?$(document):this.options.overlay;var c=a.isDocumentOverlay()?{top:0,left:0}:this.options.overlay.position();b.attr("id",this.options.id+"-overlay").addClass("ls-overlay").css({top:c.top,left:c.left,background:this.options.style.background?this.options.style.background:this.options.style.backgroundColor,"background-color":this.options.style.backgroundColor,opacity:this.options.style.opacity});this.overlay_element=b;$("body").append(b)}};ZapZapGo.LightShow.prototype.createContainer=function(){return $("<div />").hide().css({position:"absolute",height:0,width:0,top:"0px",left:"0px",padding:"0px",margin:"0px",overflow:this.options.style.overflow})};ZapZapGo.LightShow.prototype.isVisible=function(){return this.is_visible};ZapZapGo.LightShow.prototype.isElementOverlay=function(){return this.options.overlay&&this.options.overlay!="document"};ZapZapGo.LightShow.prototype.moveToTop=function(){var a=ZapZapGo.LightShow;if(a.current_z_index==-1){a.current_z_index=a.getHighestZIndex("*")+1e3}this.z_index_base=this.isElementOverlay()?ZapZapGo.LightShow.getElementZIndex(this.options.overlay)+1:a.current_z_index+=100;this.overlay_element.css("z-index",this.z_index_base+5);this.content_element.css("z-index",this.z_index_base+10);return this};ZapZapGo.LightShow.prototype.show=function(a){var b=this;if(this.effect_wait_for_load){this.effect_deferred_callback=function(){b.readapt();b.show(a)};return}if(!this.is_visible){this.is_visible=true;b.options.callback.show.before(this);if(this.z_index_base==-1){this.moveToTop()}b.options.effect.show(b.overlay_element,function(){});b.options.effect.show(b.content_element,function(){a&&a();b.options.callback.show.after(b)})}return this};ZapZapGo.LightShow.prototype.hide=function(a){var b=this;if(this.effect_wait_for_load){this.effect_deferred_callback=function(){b.readapt();b.hide(a)};return}if(this.is_visible){this.is_visible=false;this.options.callback.hide.before(this);this.options.effect.hide(this.overlay_element,function(){});b.options.effect.hide(b.content_element,function(){a&&a();b.options.callback.hide.after(b)});this.options.callback.hide.after(this)}return this};ZapZapGo.LightShow.prototype.release=function(){this.overlay_element.remove();this.content_element.remove();this.overlay_element=this.content_element=null;delete ZapZapGo.LightShow.instances[this.options.id]};ZapZapGo.LightShow.prototype.waitUntilDimensioned=function(a,b,c){var d;d=function(a){var e=[];$(a).each(function(){if(!this.complete&&this.readyState!==4){if(!($(this).width()>0&&$(this).height()>0)){e.push(this)}}});if(e.length==0){b()}else{setTimeout(function(){d(e)},c)}};d(a)};ZapZapGo.LightShow.prototype.isDocumentOverlay=function(){return this.options.overlay=="document"};ZapZapGo.LightShow.prototype.readapt=function(a){var b=this;var c=function(){if(!b.effect_wait_for_load){var a=b.isDocumentOverlay()?{top:0,left:0}:b.options.overlay.position();var c={top:a.top,left:a.left,width:b.resize_source.outerWidth(),height:b.resize_source.outerHeight()};b.overlay_element.css(c);b.content_element.css(c)}};if(a){$(window).resize(c);var d=true;$("img, iframe, script",b.options.overlay).load(c).each(function(){if(this.complete||jQuery.browser.msie&&parseInt(jQuery.browser.version)==6){$(this).trigger("load")}});this.resize_source.resize(c)}c();return this};ZapZapGo.LightShow.prototype.setEffect=function(a,b){var c,d=null;switch(a){case"fade":c=function(a,c){a.fadeIn(b,c)};d=function(a,c){a.fadeOut(b,c)};break;case"slide":c=function(a,c){a.slideDown(b,c)};d=function(a,c){a.slideUp(b,c)};break;case"toggle":c=function(a,b){a.show(b)};d=function(a,b){a.hide(b)};break;default:ZapZapGo.log("Invalid effect type '"+a+"'. Effect does not exist.");break}if(c&&d){if(!this.options.effect.show){this.options.effect.show=c}if(!this.options.effect.hide){this.options.effect.hide=d}}return this};ZapZapGo.LightShow.prototype.setContent=function(a){var b=this;if(this.content_element){this.content_element.remove();this.content_element=null}var c=(typeof a).toLowerCase()=="string"?$(a):a instanceof jQuery?a:null;if(c){var d=this.createContainer().addClass("ls-content").append(c);if($(this.options.hideButtonSelector,d).length>0){$(this.options.hideButtonSelector,d).click(function(){b.hide();return false})}this.content_element=d;$("body").append(d)}else{ZapZapGo.log("Unable to set content. Content neither JQuery element or string (HTML).")}return this};var JQuery=JQuery||$||{};jQuery.lightShow=function(a){var b;var c=ZapZapGo.LightShow;if((typeof a).toLowerCase()=="string"){var d=c.getInternalId(a);if(d in c.instances){b=c.instances[d]}else{ZapZapGo.log("Invalid ID '"+d+"'. LightShadow instance not found.")}}else{var d=a.id=c.getInternalId(a.id);if(d in c.instances){ZapZapGo.log("LightShadow instance ID '"+d+"' already used. Please select another one")}else{b=c.instances[d]=new c(a)}}return b}